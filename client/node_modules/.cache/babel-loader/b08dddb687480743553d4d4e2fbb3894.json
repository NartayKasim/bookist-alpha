{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/KASIM/Documents/bookist-alpha/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/KASIM/Documents/bookist-alpha/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/KASIM/Documents/bookist-alpha/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useEffect}from\"react\";import{useState}from\"react\";import{useDispatch,useSelector}from\"react-redux\";import{useNavigate}from\"react-router\";import{withRouter}from\"../../app/hocs\";import{v4 as uuidv4}from\"uuid\";import{getUserBooks,updateBooklistName}from\"../../services/librarySlice\";import axios from\"axios\";import BooklistPageHeader from\"../../components/booklist/header/BooklistPageHeader\";import classes from\"./BooklistPage.module.css\";import BooklistItem from\"../../components/booklist/item/BooklistItem\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var BooklistPage=function BooklistPage(_ref){var id=_ref.id,title=_ref.title;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),books=_useState2[0],setBooks=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),editTitle=_useState4[0],setEditTitle=_useState4[1];var navigate=useNavigate();var dispatch=useDispatch();var userBooks=useSelector(function(state){return state.library.userBooks;});var onBooklistRenameClick=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(newBooklistTitle){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(newBooklistTitle!==title&&newBooklistTitle.length>0&&newBooklistTitle!==\"Read Books\")){_context.next=5;break;}_context.next=3;return axios.put(\"/api/library/booklist/rename\",{booklist_id:id,booklistTitle:newBooklistTitle});case 3:console.log(title,newBooklistTitle);dispatch(updateBooklistName({oldName:title,newName:newBooklistTitle}));case 5:setEditTitle(false);navigate(\"/booklist/?id=\".concat(id,\"&title=\").concat(newBooklistTitle));case 7:case\"end\":return _context.stop();}}},_callee);}));return function onBooklistRenameClick(_x){return _ref2.apply(this,arguments);};}();var onBooklistDeleteClick=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return axios.post(\"/api/library/booklist/delete\",{booklistTitle:title});case 2:_context2.next=4;return dispatch(getUserBooks());case 4:navigate(\"/library\");case 5:case\"end\":return _context2.stop();}}},_callee2);}));return function onBooklistDeleteClick(){return _ref3.apply(this,arguments);};}();var onRemoveBookClick=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(book){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return axios.post(\"/api/library/booklist/remove\",{book:book,booklistTitle:title}).then(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return dispatch(getUserBooks());case 2:setBooks(null);case 3:case\"end\":return _context3.stop();}}},_callee3);})));case 2:case\"end\":return _context4.stop();}}},_callee4);}));return function onRemoveBookClick(_x2){return _ref4.apply(this,arguments);};}();useEffect(function(){var updateBooks=/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return dispatch(getUserBooks());case 2:case\"end\":return _context5.stop();}}},_callee5);}));return function updateBooks(){return _ref6.apply(this,arguments);};}();if(title){if(books===null){updateBooks();setBooks(userBooks.filter(function(book){return book.booklists&&book.booklists.includes(title);}));}}else{navigate(\"/\");}},[navigate,dispatch,title,userBooks,books]);return/*#__PURE__*/_jsx(_Fragment,{children:books!==null&&/*#__PURE__*/_jsxs(\"div\",{className:classes.booklistPageWrapper,children:[/*#__PURE__*/_jsx(BooklistPageHeader,{title:title,editTitle:editTitle,setEditTitle:setEditTitle,onBooklistRenameClick:onBooklistRenameClick,onBooklistDeleteClick:onBooklistDeleteClick,books:books,editBooks:true}),/*#__PURE__*/_jsx(\"div\",{className:classes.booklistPageBody,children:books&&books!==null&&books.map(function(book){return/*#__PURE__*/_jsx(BooklistItem,{book:book,editable:true,onRemoveBookClick:onRemoveBookClick},uuidv4());})})]})});};export default withRouter(BooklistPage);","map":{"version":3,"sources":["C:/Users/KASIM/Documents/bookist-alpha/client/src/pages/booklist/BooklistPage.jsx"],"names":["useEffect","useState","useDispatch","useSelector","useNavigate","withRouter","v4","uuidv4","getUserBooks","updateBooklistName","axios","BooklistPageHeader","classes","BooklistItem","BooklistPage","id","title","books","setBooks","editTitle","setEditTitle","navigate","dispatch","userBooks","state","library","onBooklistRenameClick","newBooklistTitle","length","put","booklist_id","booklistTitle","console","log","oldName","newName","onBooklistDeleteClick","post","onRemoveBookClick","book","then","updateBooks","filter","booklists","includes","booklistPageWrapper","booklistPageBody","map"],"mappings":"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","sourcesContent":["import { useEffect } from \"react\";\r\nimport { useState } from \"react\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { useNavigate } from \"react-router\";\r\nimport { withRouter } from \"../../app/hocs\";\r\nimport { v4 as uuidv4 } from \"uuid\";\r\nimport { getUserBooks, updateBooklistName } from \"../../services/librarySlice\";\r\nimport axios from \"axios\";\r\nimport BooklistPageHeader from \"../../components/booklist/header/BooklistPageHeader\";\r\nimport classes from \"./BooklistPage.module.css\";\r\nimport BooklistItem from \"../../components/booklist/item/BooklistItem\";\r\n\r\nconst BooklistPage = ({ id, title }) => {\r\n   const [books, setBooks] = useState(null);\r\n   const [editTitle, setEditTitle] = useState(false);\r\n\r\n   const navigate = useNavigate();\r\n   const dispatch = useDispatch();\r\n   const userBooks = useSelector((state) => state.library.userBooks);\r\n\r\n   const onBooklistRenameClick = async (newBooklistTitle) => {\r\n      if (\r\n         newBooklistTitle !== title &&\r\n         newBooklistTitle.length > 0 &&\r\n         newBooklistTitle !== \"Read Books\"\r\n      ) {\r\n         await axios.put(\"/api/library/booklist/rename\", {\r\n            booklist_id: id,\r\n            booklistTitle: newBooklistTitle,\r\n         });\r\n         console.log(title, newBooklistTitle);\r\n         dispatch(\r\n            updateBooklistName({\r\n               oldName: title,\r\n               newName: newBooklistTitle,\r\n            })\r\n         );\r\n      }\r\n      setEditTitle(false);\r\n      navigate(`/booklist/?id=${id}&title=${newBooklistTitle}`);\r\n   };\r\n\r\n   const onBooklistDeleteClick = async () => {\r\n      await axios.post(\"/api/library/booklist/delete\", {\r\n         booklistTitle: title,\r\n      });\r\n      await dispatch(getUserBooks());\r\n      navigate(\"/library\");\r\n   };\r\n\r\n   const onRemoveBookClick = async (book) => {\r\n      await axios\r\n         .post(\"/api/library/booklist/remove\", { book, booklistTitle: title })\r\n         .then(async () => {\r\n            await dispatch(getUserBooks());\r\n            setBooks(null);\r\n         });\r\n   };\r\n\r\n   useEffect(() => {\r\n      const updateBooks = async () => {\r\n         await dispatch(getUserBooks());\r\n      };\r\n      if (title) {\r\n         if (books === null) {\r\n            updateBooks();\r\n            setBooks(\r\n               userBooks.filter(\r\n                  (book) => book.booklists && book.booklists.includes(title)\r\n               )\r\n            );\r\n         }\r\n      } else {\r\n         navigate(\"/\");\r\n      }\r\n   }, [navigate, dispatch, title, userBooks, books]);\r\n\r\n   return (\r\n      <>\r\n         {books !== null && (\r\n            <div className={classes.booklistPageWrapper}>\r\n               <BooklistPageHeader\r\n                  title={title}\r\n                  editTitle={editTitle}\r\n                  setEditTitle={setEditTitle}\r\n                  onBooklistRenameClick={onBooklistRenameClick}\r\n                  onBooklistDeleteClick={onBooklistDeleteClick}\r\n                  books={books}\r\n                  editBooks={true}\r\n               />\r\n               <div className={classes.booklistPageBody}>\r\n                  {books &&\r\n                     books !== null &&\r\n                     books.map((book) => (\r\n                        <BooklistItem\r\n                           key={uuidv4()}\r\n                           book={book}\r\n                           editable={true}\r\n                           onRemoveBookClick={onRemoveBookClick}\r\n                        />\r\n                     ))}\r\n               </div>\r\n            </div>\r\n         )}\r\n      </>\r\n   );\r\n};\r\n\r\nexport default withRouter(BooklistPage);\r\n"]},"metadata":{},"sourceType":"module"}